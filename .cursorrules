# Development Rules

## Production = main (mandatory)
- **Main is production.** Pushes to `main` deploy to sea-lion-app (https://sea-lion-app-8l7y7.ondigitalocean.app/). Production spec: **app.production.yaml**. Use DigitalOcean MCP (user-digitalocean-apps) for deploy readiness: App ID `a639b515-01d7-489e-bccb-074a9cf6f62a`. See **docs/PRODUCTION_MAIN.md** and **DEVOPS_README.md**.

## Worktrees & Agents (mandatory)
- **Never use "Apply worktree to current branch".** It causes data loss when the target worktree is missing files. Use git only: commit in this workspace → push → pull/merge in the other worktree. See **WORKTREE_AND_AGENTS.md**.
- `.cursor/` and `frontend/src/design-system/` are tracked in git; do not add them to .gitignore. Commit changes to them so all worktrees get them via git pull.

## Rendering Verification
- **ALWAYS verify frontend rendering before completing tasks**
- After making frontend changes:
  1. Build the frontend: `cd frontend && npm run build`
  2. Check for TypeScript/compilation errors
  3. Verify the app loads in browser (check console for runtime errors)
  4. Test key user interactions
- If rendering fails, fix issues before marking tasks complete

## Server Execution
- **ALWAYS run frontend and backend dev servers in background mode**
- Use `is_background: true` when starting servers
- Never block the console with interactive processes
- Example: `npm run dev` should always run in background

## Design System
- **Use the in-repo design system from `frontend/src/design-system`** (no external package)
- All design-system files live in this project: `tokens.css`, `themes.css`, `glass.css`, `tokens/`, etc. See `frontend/src/design-system/DESIGN_SYSTEM.md`
- Import tokens: `import { tokens } from '../design-system'` or `import { tokens } from '../design-system/tokens'`
- Use CSS variables: `var(--color-primary-500)`, `var(--spacing-4)`, `var(--glass-bg)`, etc.
- Follow atomic design principles (atoms, molecules, organisms)
- Use component interfaces: `import type { ButtonProps } from '../design-system'`

## Icons
- **Use SVG icons instead of emojis**
- Create reusable icon components in `frontend/src/assets/icons.tsx`
- Icons should accept `className` and `size` props
- Use proper SVG with `currentColor` for theming

## Code Quality
- Fix all TypeScript errors before completing tasks
- Use `import type` for type-only imports
- Follow project conventions from `openspec/project.md`
- Write clean, maintainable code
